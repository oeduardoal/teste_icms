var app = angular.module('app',['ui.router']);
app.config(function($stateProvider,$urlRouterProvider, $locationProvider){
	// $locationProvider.hashPrefix('');
	// $urlRouterProvider.otherwise('/');
	// $locationProvider.html5Mode(true);
});

app.constant("configs",{
	domain: 'http://192.168.2.250/icms'
});

app.factory('NCMS',function($http, $timeout,configs){

	var ncms;
	var obj = {};

	obj = {
		getNcm: function(scope, callback){
			if(ncms){
				// callback(ncms);
				// return false;
				$http.get(configs.domain + "/wp-json/wp/v2/observacao/?search=" + scope.input)
				.then(function(data){
					obj.save(data);
					callback(data);
				}).then(function(){})
			}else{
				$http.get(configs.domain + "/wp-json/wp/v2/observacao/?search=" + scope.input)
				.then(function(data){
					obj.save(data);
					callback(data);
				}).then(function(){})
			}
		},
		save: function(data){
			ncms = data;
		}
	}
	return obj;
});
app.filter('unsafe', function($sce) { return $sce.trustAsHtml; });
app.directive('ngDelay', ['$timeout', function ($timeout) {
    return {
        restrict: 'A',
        scope: true,
        compile: function (element, attributes) {
            var expression = attributes['ngChange'];
            if (!expression)
                return;
            
            var ngModel = attributes['ngModel'];
            if (ngModel) attributes['ngModel'] = '$parent.' + ngModel;
            attributes['ngChange'] = '$$delay.execute()';
            
            return {
                post: function (scope, element, attributes) {
                    scope.$$delay = {
                        expression: expression,
                        delay: scope.$eval(attributes['ngDelay']),
                        execute: function () {
                            var state = scope.$$delay;
                            state.then = Date.now();
                            $timeout(function () {
                                if (Date.now() - state.then >= state.delay)
                                    scope.$parent.$eval(expression);
                            }, state.delay);
                        }
                    };
                }
            }
        }
    };
}]);
app.controller('main', ['$scope', '$http','$timeout','NCMS',function($scope,$http,$timeout,NCMS){

	
	$scope.loading = true;

	$scope.getncms = function(){
		$scope.ncms = "";
		NCMS.getNcm($scope, function(data){
			$scope.ncms = data.data;
			$scope.loading = false;
			if($scope.ncms == []){
				$scope.vazio = true;
			}else{
				$scope.vazio = false;
			};
			console.log($scope.vazio)
		});
		
	}
	
	var input = $scope.input;
}]);
